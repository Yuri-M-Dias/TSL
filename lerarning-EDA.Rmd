---
title: "Learning time series!"
output: html_notebook
---

# Learning Time Series

```{r}
library(data.table)
library(tidyverse)

data = fread('./Data/daily-total-female-births.csv')

slw = as.data.table(
  matrix(data$Births, ncol = 4,  byrow = TRUE),
  stringsAsFactors = FALSE
)

slw = slw[,.(nextValue = V4), by = list(V1,V2,V3)]
```

Great!

```{r}
library(keras)

model <- keras_model_sequential() 
model %>% 
  layer_dense(units = 100, activation = 'relu', input_shape = 3) %>% 
  layer_dense(units = 1)

model %>% compile(
  loss = 'mse',
  optimizer = optimizer_adam(),
  metrics = list("mean_absolute_error")
)

slwm = as.matrix(slw)
slwm.train = slwm[1:69,]
slwm.test = slwm[69:92,]

# The patience parameter is the amount of epochs to check for improvement.
early_stop <- callback_early_stopping(monitor = "val_loss", patience = 20)

history <- model %>% fit(
  x = slwm.train[,1:3],
  y = slwm.train[,4],
  epochs = 2000,
  callbacks = list(early_stop),
  verbose = 2
)

model %>% evaluate(x = slwm.test[,1:3], y = slwm.test[,4])

```


